<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login - SoulSync</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container ss">
    <img src="soulsync.png" width="200" height="200" class="ssi" alt="logo"/>
    <form class="form" onsubmit="return false;">
      <h2>LOGIN:</h2>
      <label class="label">Enter UserName:</label>
      <input id="name" class="in" type="text" required/>
      <label class="label">Enter Password:</label>
      <input id="password" class="in" type="password" required/>
      <button type="button" class="fbtn-btn" onclick="check()">login</button>
      <p><a href="signin.html">Sign up</a></p>
    </form>
  </div>

<script>
async function check(){
  const username = document.getElementById('name').value;
  const password = document.getElementById('password').value;

  const res = await fetch("http://localhost:3000/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
  });

  let suc = await res.json();

  if (suc.success) {
    localStorage.setItem("token", suc.token);

    if(suc.user.role === "user"){
      window.location.href = "Section.html";
    }
    if(suc.user.role === "admin"){
      window.location.href = "Adminsec.html";
    }
    return;
  }

  if (suc.message === "User not found") {
      alert("Please Sign Up");
      window.location.href = "Signin.html";
      return;
  }

  if (suc.message === "Wrong password") {
      alert("Wrong Password");
      return;
  }

  alert("Unknown login error");
}
</script>

</body>
</html>